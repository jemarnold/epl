---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
    dpi = 300
)
```

# `{epl}` package

<!-- badges: start -->

<!-- badges: end -->

`{epl}` is a repository of functions and scripts for common tasks for use by students in the UBC Environmental Physiology Laboratory.

## Online App

`<under development>`

## Installation

You can install the development version of `{epl}` from [GitHub](https://github.com/jemarnold/epl) with:

``` r
# install.packages("remotes")
remotes::install_github("jemarnold/epl")
```

## Usage

### `read_tymewear()`

This function will read *"Live Processed CSV"* or *"Post Processed CSV"* files exported from *Tymewear VitalPro* and return a list of two data frames with recorded data and file details.

`tyme$data` contains the recorded raw data samples for breathing rate, tidal volume, and ventilation: `c("br", "vt", "ve")`, with time in seconds and timestamps in `datetime` format.

`tyme$details` contains the file details & metadata, including `c("gender", "weight", "date", "app-start-time")`.

```{r}
## load {epl} package
library(epl)

## specify the file path via any number of methods
## this gives an example format
file_path <- file.path("root_project_folder", "data_folder", "my_file.csv")
file_path

## example files are available by calling `example_epl()`
file_path <- example_epl("tymewear_live")

tymelive <- read_tymewear(file_path)
tymelive

```

### `read_parvo()`

This function will read *.CSV* or *.xlsx* (but not *.XLS*) files exported by *Parvo Medics TrueOne 2400* and return a list of three data frames with recorded data, file details, and events.

`parvo$data` contains the recorded raw data samples for exported data channels (e.g. `c("VO2", "VCO2", "RR", "Vt")`) and calculated metabolic values (e.g. `c("O2kJ", "O2kcal", "Paer", "METS")`; see `?read_parvo` for details on calculated values).

`parvo$details` contains the file details & metadata, including `c("Date", "Name", "Sex", "Age")` (all metric values).

`parvo$events` contains any manually entered events with `"TIME"` in seconds and event descriptions.

```{r}

file_path <- example_epl("parvo_binned")

parvo <- read_parvo(file_path)
parvo
```

`read_parvo()` has an argument to add timestamps in `datetime` format to `parvo$data`, taken from `parvo$details` file start time. This is recorded from system time to the nearest whole second (i.e. precise to ± 0.05 sec, assuming system time is accurate).

```{r}
## timestamps can be added
read_parvo(file_path, add_timestamp = TRUE)$data
```

### Helper Functions

`<under development>`

#### `example_epl()`

This function can be used to retrieve example files included in {epl} to test processing functions.

```{r}
## calling `example_epl()` will return a list of all included example files
example_epl()

## calling a specific file by name will return the file path to that file
## partial string matching works for uniquely identifiable file names
example_epl("tymewear_live")

## partial matching will error if matches multiple
#> example_epl("tymewear")
#> Error in `example_epl()`:
#> ! Multiple files match "tymewear":
#> ℹ Matching files: "tymewear_live.csv" and "tymewear_post.csv"
```
